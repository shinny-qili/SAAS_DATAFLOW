# 各表格字段必填和选填约定

本文档定义各个表格在新增和编辑时，系统缺省字段、必填字段和选填字段的约定。

## 一、合同表（contract）

### 必填字段
- **保值方案_id**（int）：关联的保值方案ID
- **计价方式**（str）：一口价/暂定价/均价

### 系统缺省字段
- **创建人**（int）：初始设置为当前登录用户的人员ID
- **创建日期时间**（datetime）：初始设置为当前系统时间
- **已点数量**（decimal）：初始设置为0
- **状态**（str）：初始设置为"enable"（启用）

### 选填字段

#### 时间相关字段
- **发生日期时间**（datetime）：发生日期时间
  - 说明：不填写时，系统将使用创建日期时间作为发生日期时间
- **均价起止日**（date）：均价计算的起始日期和结束日期
  - 说明：不填写时，无法进行均价计算（需要敞口配置支持）
- **点价截止日**（date）：点价的截止日期
  - 说明：不填写时，无法进行自助点价操作
- **交割日期**（date）：交割日期
  - 说明：不填写时，无法自动交收，所有合同会出现在匹配待选列表中

#### 人员与客商相关字段
- **业务经理**（int）：人员ID，关联业务经理
  - 说明：不填写时，将失去合同与业务经理的通知关联、代点价权限
- **供应商/客户**（int）：客商ID
  - 说明：不填写时，无法进行自助点价操作

#### 品种与品牌相关字段
- **现货品种**（int）：现货品种ID
  - 说明：不填写时，无法选择品牌、无法配置敞口、无法进行均价计算、无法进行点价操作
- **品牌**（int）：品牌ID
  - 说明：不填写时，无法配置敞口、无法进行均价计算、无法进行点价操作

#### 数量与价格相关字段
- **合同数量**（decimal）：合同数量
  - 说明：不填写时，无法配置敞口、无法进行均价计算、无法进行点价操作
- **单价**（decimal）：单价
  - 说明：不填写时，无法计算基差、无法计算合同金额
- **结算单价**（decimal）：结算单价
  - 说明：不填写时，无法计算结算基差、无法计算结算金额

#### 其他字段
- **合同编号**（str）：合同编号
  - 说明：不填写时，期现备注中无法选中该合同
- **运输方式**（str）：自提/送到
- **备注**（str）：备注信息

---

## 二、客商表（customer）

### 必填字段
- **客商分类**（int）：客商类型ID，关联客商类型（供应商、客户、仓库、物流、撮合商、客商等）
- **简称**（str）：客商简称（需唯一）
- **全称**（str）：客商全称（需唯一）

### 系统缺省字段
- **状态**（str）：自动设置为"enable"（启用）

### 选填字段
- **联系人**（str）：联系人姓名
- **手机号**（str）：联系人手机号
- **备注**（str）：备注信息

---

## 三、现货品种表（spot_variety）

### 必填字段
- **名称**（str）：现货品种名称（需唯一）

### 系统缺省字段
- **状态**（str）：自动设置为"enable"（启用）

### 选填字段
- **备注**（str）：备注信息

---

## 四、品牌表（spot_brand）

### 必填字段
- **现货品种_id**（int）：关联的现货品种ID
- **名称**（str）：品牌名称（需唯一）

### 系统缺省字段
- **是否主港**（bool）：自动设置为false
- **是否平台价**（bool）：自动设置为false
- **状态**（str）：自动设置为"enable"（启用）

### 选填字段
- **价格**（decimal）：品牌价格
  - 说明：应用于主港和平台价类型的品牌
- **升贴水**（decimal）：品牌升贴水
  - 说明：应用于非主港类型的品牌
- **期货品种**（json_list）：期货品种ID列表，可关联多个期货品种
- **敞口系数**（json_list）：敞口系数列表，与期货品种一一对应
- **备注**（str）：备注信息

---

## 五、人员表（person/user）

### 必填字段
- **姓名**（str）：人员姓名（需唯一）

### 系统缺省字段
- **状态**（str）：自动设置为"enable"（启用）

### 选填字段
- **手机号**（str）：人员手机号
- **备注**（str）：备注信息

---

## 六、角色表（role）

### 必填字段
- **名称**（str）：角色名称（需唯一）

### 系统缺省字段
- **状态**（str）：自动设置为"enable"（启用）

### 选填字段
- **人员列表**（json_list）：人员ID列表，可关联多个人员
- **角色解释**（str）：角色的定义和说明
- **备注**（str）：备注信息

---

## 七、期货账户表（futures_account）

### 必填字段
- **期货账户**（str）：期货账户名称或编号

### 系统缺省字段
- **账户状态**（str）：自动设置为"enable"（启用）

### 选填字段
- **密码**（str）：账户密码
- **期货公司**（str）：期货公司名称
- **前置**（str）：前置服务器地址
- **交易员**（json_list）：交易员ID列表，可关联多个交易员
- **别名**（str）：用于界面显示，切换账户时更好区分
- **备注**（str）：备注信息

---

## 八、保值方案表（hedge_plan）

### 必填字段
- **名称**（str）：保值方案名称（需唯一）
- **类型**（str）：整体匹配/单单匹配/无合同（人员）/无合同（客商）

### 系统缺省字段
- **状态**（str）：自动设置为"enable"（启用）

### 选填字段
- **交易员列表**（json_list）：交易员ID列表；决定指令权限设置时指定交易员的可选范围
- **制单员列表**（json_list）：制单员ID列表；决定指令权限设置时指定制单员的可选范围
- **指令类型**（json_list）：指令类型列表；决定指令权限设置时指令类型的可选范围
- **标签列表**（json_list）：标签字符串列表；决定期现备注中的可选范围
- **备注**（str）：备注信息

---

## 九、期货委托单表（entrust_order）

### 在这里不做定义了，需要注意以下内容
- **保值方案_id**（int）：关联的保值方案ID
- **指令_id**（int）：关联的指令编号
- **短编号**（str）：众期短编号
- **委托备注**（str）：委托备注（支持富文本）
- **备注**（str）：备注信息

---

## 十、期现备注表（spot_futures_remark）

### 必填字段
- **委托_id**（int）：关联的委托单ID
- **手数**（decimal）：期现备注的手数（必填，且所有期现备注的总手数不能大于委托单的已成交手数）

### 系统缺省字段
- **是否已匹配**（bool）：自动设置为false

### 选填字段
- **现货数量**（decimal）：现货数量
- **点价价格**（decimal）：点价价格
- **标签**（str）：标签，来源于对应保值方案设置的标签列表
- **备注**（str）：备注信息
- **客商_id**（int）：客商ID（如果已选合同则不能选）
- **合同_id**（int）：合同ID（如果保值方案是单单才允许选取）

### 特殊说明
- 期现备注是委托单的附属信息，一条委托单可以有多条期现备注
- 期现备注中的总手数不能大于委托单的已成交手数
- 如果保值方案是"单单匹配"类型，才允许选取合同
- 如果已选择合同，则不能选择客商

---

## 十一、通用规则

### 1. 系统缺省字段规则
- 系统缺省字段在新增记录时自动填充，用户无需手动输入
- 系统缺省字段在编辑时通常不允许修改（如创建人、创建时间等）
- 状态字段默认为"enable"（启用），可通过禁用/启用功能修改

### 2. 必填字段验证
- 所有必填字段在保存前必须进行验证
- 必填字段在表单中应明确标识（如显示红色星号）
- 保存时如果必填字段为空，应提示用户并阻止保存

### 3. 唯一性验证
- 对于标注"需唯一"的字段，在新增和编辑时需要验证唯一性
- 如果违反唯一性约束，应提示用户并阻止保存

### 4. 关联字段验证
- 对于关联其他表的字段（如_id字段），需要验证关联记录是否存在
- 对于关联记录已被删除或禁用的，应提示用户并阻止保存

### 5. 业务逻辑验证
- 某些字段之间存在业务逻辑关系，需要在保存时进行验证
- 例如：期现备注的总手数不能大于委托单的已成交手数
- 例如：保值方案的指令类型需要与保值方案类型匹配

### 6. 自定义字段
- 根据自定义字段配置，某些自定义字段可能被设置为必填
- 自定义字段的必填性由管理员在自定义字段配置中设置
- 系统标准字段的必填性按本文档约定执行

---

## 十二、字段类型说明

- **str**：字符串类型
- **int**：整数类型
- **decimal**：小数类型，用于金额、数量等
- **bool**：布尔类型，true/false
- **date**：日期类型
- **datetime**：日期时间类型
- **json_list**：JSON数组类型，用于存储多个值的列表

---

## 十三、后续扩展

如果后续版本中新增表格或修改字段规则，需要同步更新本文档。

