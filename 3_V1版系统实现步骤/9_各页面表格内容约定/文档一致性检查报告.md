# 文档一致性检查报告（已更新）

本文档检查了五个约定文档（9_1、9_2、9_3、9_4、9_5）之间的冲突和逻辑问题，用于更新prototype.html。

**更新日期**：2025-01-XX
**状态**：已根据用户反馈更新文档

## 一、字段名称一致性检查

### ✅ 基本一致
- 合同表、客商表、现货品种表、品牌表、人员表、角色表、期货账户表、保值方案表、期货委托单表、期现备注表的字段名称在四个文档中基本保持一致。

### ⚠️ 需要注意的差异
1. **9_1文档**使用下划线命名（如`保值方案_id`），而**9_2、9_3、9_4文档**使用中文名称（如`保值方案`）
   - 这是正常的，9_1是数据库字段定义，其他是显示层定义
   - **建议**：在prototype.html中需要明确字段映射关系

## 二、字段完整性检查

### ❌ 问题1：合同表字段遗漏

#### 9_2文档（默认字段显示）中显示但9_1文档（必填选填）中未定义的字段：
- **结算金额**：9_2中显示，但9_1中未定义
  - 9_2第64行：显示结算金额（自动计算）
  - **问题**：结算金额的计算规则是什么？是否等于结算单价 × 合同数量？

#### 9_4文档（弹窗）中显示但9_1文档中未定义的字段：
- **结算金额**：9_4第26行提到，但9_1中未定义

**✅ 已解决**：
1. 结算金额的计算公式：结算金额 = 合同数量 × 结算单价（已在9_5文档中定义）
2. 结算金额是计算字段，不存储，实时计算（已在9_1文档中补充说明）

### ✅ 问题2：合同表"未点数量"字段（已解决）

- **9_2文档**第76-80行：定义了"未点数量"列，显示为"合同数量 - 已点数量"
- **9_1文档**：未定义此字段
- **9_4文档**第28行：弹窗中显示"未点数量"

**问题**：未点数量是计算字段还是存储字段？
- 如果是计算字段，应该在9_1文档中说明
- 如果是存储字段，应该在9_1文档中定义

**✅ 已解决**：
1. 未点数量是计算字段，计算公式：未点数量 = 合同数量 - 已点数量（已在9_5文档中定义）
2. 已在9_1文档中补充说明为计算字段

### ✅ 问题3：合同表"合同金额"字段（已解决）

- **9_2文档**第64-68行：定义了"合同金额"列，显示为"自动计算：合同数量 × 单价"
- **9_1文档**：未定义此字段
- **9_4文档**第25行：弹窗中显示"合同金额（自动计算）"

**✅ 已解决**：
1. 合同金额是计算字段，计算公式：合同金额 = 合同数量 × 单价（已在9_5文档中定义）
2. 已在9_1文档中补充说明为计算字段

### ✅ 问题4：期货委托单表字段定义不完整（已解决）

**9_1文档**第174-181行：
- 说明"在这里不做定义了，需要注意以下内容"
- 只列出了5个字段，但缺少很多重要字段

**9_2文档**第553-626行：
- 定义了13个默认显示字段，包括：指令编号、短编号、保值方案、合约、方向、成交日期、成交价格、成交手数、已匹配手数、未匹配手数、是否已匹配、状态、创建日期时间

**冲突**：9_1文档说"不做定义"，但9_2、9_3、9_4文档都详细定义了字段

**✅ 已解决**：
1. 已在9_1文档中补充完整的期货委托单表字段定义（必填、选填、系统缺省）
2. 已补充交易所提供的核心字段定义（委托单、持仓、成交、平仓字段）
3. 详细字段定义已在9_5文档中说明

### ✅ 问题5：期现备注表字段定义不完整（已解决）

**9_1文档**第185-207行：
- 定义了必填字段、系统缺省字段、选填字段
- 但缺少"委托单短编号"字段的定义

**9_2文档**第670-731行：
- 默认显示字段包括"委托单短编号"

**9_3文档**第519-581行：
- 筛选字段包括"委托单"（显示为短编号或指令编号）

**问题**：委托单短编号是期现备注表的字段还是从委托单关联获取的？

**✅ 已解决**：
1. 委托单短编号是关联显示字段，通过"委托_id"关联期货委托单表获取（已在9_5文档中说明）
2. 已在9_5文档中补充说明

## 三、字段类型一致性检查

### ✅ 基本一致
- 大部分字段类型在文档中保持一致（str、int、decimal、bool、date、datetime、json_list）

### ⚠️ 问题6：合同表"供应商/客户"字段

**9_1文档**第32行：
- 定义为`供应商/客户`（int）：客商ID

**9_2文档**第26-29行：
- 显示为"供应商/客户"，显示客商简称

**9_3文档**第28-34行：
- 筛选字段为"供应商/客户"，根据合同类型筛选供应商或客户

**问题**：这个字段在数据库中是一个字段还是两个字段？
- 如果是采购合同，存储的是供应商ID
- 如果是销售合同，存储的是客户ID

**✅ 已解决**：
1. 供应商/客户是同一个字段，界面显示名称根据合同类型不同而不同（采购合同显示"供应商"，销售合同显示"客户"）
2. 已在9_1文档中补充说明

## 四、弹窗内容一致性检查

### ❌ 问题7：9_4文档内容不完整

**9_4文档**只定义了合同表的三个可点击弹窗列：
1. 合同编号
2. 供应商/客户
3. 品牌

但**9_2文档**第143-220行定义了更多可点击弹窗的列，包括：
- 合同编号（9_4已定义）
- 供应商/客户（9_4已定义）
- 品牌（9_4已定义）

**问题**：其他表格（客商表、品牌表、人员表等）是否也需要定义弹窗内容？

**✅ 已解决**：
1. 已在9_4文档中补充了所有其他表格的弹窗定义（客商表、现货品种表、品牌表、人员表、角色表、期货账户表、保值方案表、期货委托单表、期现备注表）

### ✅ 问题8：弹窗中子表格的字段定义（已解决）

**9_4文档**第42行：
- 提到"期现关联记录：显示关联的期货委托单信息（合约、数量、成交日期等）"

**9_2文档**第107-142行：
- 详细定义了期现关联记录表格的默认字段显示（7个字段）

**一致性**：两个文档基本一致，但9_4文档的描述较简略

**建议**：9_4文档可以引用9_2文档的详细定义，或者补充完整

## 五、筛选字段与显示字段一致性检查

### ✅ 基本一致
- **9_3文档**第867-892行专门说明了与9_2文档的一致性
- 大部分筛选字段在显示字段中都有对应

### ⚠️ 问题9：筛选字段"是否已定价"、"是否已交收"、"是否在定价期"

**9_3文档**第69-91行：
- 定义了三个计算字段的筛选：是否已定价、是否已交收、是否在定价期

**9_2文档**：
- 未在默认显示字段中定义这些列

**问题**：这些计算字段是否应该在9_2文档中作为可选显示列？

**✅ 已解决**：
1. 已在9_2文档中补充了这三个计算字段的显示列定义
2. 这些字段默认不显示，可通过列配置添加到表格中显示

### ⚠️ 问题10：筛选字段"结算金额"缺失（待确认）

**9_2文档**第64-68行：
- 定义了"合同金额"列（自动计算）

**9_3文档**：
- 未定义"合同金额"的筛选

**问题**：合同金额是否需要筛选功能？

**待确认**：
1. 合同金额是否需要支持筛选（范围筛选）？
2. 如果需要，是否应该添加到9_3文档的高级筛选中？
3. 结算金额是否需要支持筛选（范围筛选）？

## 六、逻辑冲突检查

### ❌ 问题11：合同表"合同编号"字段

**9_1文档**第50行：
- 合同编号是选填字段
- 说明：不填写时，期现备注中无法选中该合同

**9_2文档**第11行：
- 合同编号是默认显示的第一列（可点击弹窗）

**9_3文档**第23行：
- 合同编号是默认筛选字段

**逻辑问题**：如果合同编号是选填的，那么：
1. 没有合同编号的合同如何在表格中显示？（显示为空还是显示ID？）
2. 没有合同编号的合同如何筛选？（无法通过合同编号筛选）

**待确认**：
1. 合同编号是否应该改为必填字段？
2. 如果不改为必填，没有合同编号的合同如何在表格中显示？（显示为空还是显示ID？）
3. 没有合同编号的合同如何筛选？（无法通过合同编号筛选）

### ⚠️ 问题12：品牌表"是否主港"和"是否平台价"的三态选择（待确认）

**9_3文档**第246-264行：
- 定义了"是否主港"和"是否平台价"的筛选，支持三态选择（是/否/继承/全部）

**9_1文档**第94-95行：
- 定义为布尔类型，系统缺省为false

**问题**："继承"状态是什么意思？与布尔类型的true/false如何对应？

**需要回答的问题**：
1. "继承"状态的具体含义是什么？
2. 数据库中如何存储"继承"状态？（是null还是特殊值？）

### ⚠️ 问题13：期现备注表的"客商"和"合同"字段互斥逻辑

**9_1文档**第199-206行：
- 客商_id（int）：如果已选合同则不能选
- 合同_id（int）：如果保值方案是单单才允许选取
- 特殊说明：如果已选择合同，则不能选择客商

**9_2文档**第686-694行：
- 默认显示字段包括"客商"和"合同编号"

**9_3文档**第538-552行：
- 筛选字段包括"客商"和"合同"

**逻辑问题**：筛选时，如果同时选择了客商和合同，如何处理？

**待确认**：
1. 筛选时，客商和合同是否可以同时选择？
2. 如果同时选择，是"且"关系还是"或"关系？
3. 如果同时选择，是否应该提示用户这两个字段互斥？

## 七、文档结构问题

### ❌ 问题14：9_4文档缺少其他表格的定义

**9_4文档**只定义了合同表的弹窗，但其他表格（如客商表、品牌表）在9_2文档中也提到了可点击弹窗的列。

**需要回答的问题**：
1. 9_4文档是否需要补充其他表格的弹窗定义？
2. 还是说其他表格的弹窗定义在9_2文档中已经足够？

### ⚠️ 问题15：9_2文档中"可点击弹窗的列"章节重复

**9_2文档**第143行和第145行：
- 出现了两次"### 可点击弹窗的列"标题

**✅ 已解决**：已在9_2文档中修复重复标题问题

## 八、与prototype.html的兼容性问题

### ⚠️ 问题16：prototype.html中的字段命名

从prototype.html的代码来看：
- 使用驼峰命名（如`hedgePlan`、`contractNo`）
- 而文档中使用中文名称

**需要回答的问题**：
1. prototype.html是否需要保持当前的字段命名方式？
2. 还是需要改为与文档一致的中文名称？

### ⚠️ 问题17：prototype.html中的列定义

prototype.html第3402-3417行定义了合同表的列，但：
- 列的顺序与9_2文档不完全一致
- 缺少一些9_2文档中定义的列（如"未点数量"）

**需要回答的问题**：
1. prototype.html是否需要按照9_2文档的列顺序和列定义更新？
2. 是否需要添加缺失的列？

## 九、更新总结

### ✅ 已解决的问题

1. **计算字段定义**：已在9_5文档中定义所有计算字段的计算公式和数据来源
2. **9_1文档补充**：已补充计算字段说明、期货委托单表完整定义、供应商/客户字段说明
3. **9_4文档补充**：已补充所有其他表格的弹窗定义
4. **9_2文档补充**：已补充筛选字段对应的显示列（是否已定价、是否已交收、是否在定价期），修复重复标题
5. **文档格式**：已修复9_2文档中的重复标题问题

### ⚠️ 待确认的问题（中优先级）

1. **结算金额的计算公式是什么？是否应该作为系统缺省字段？**
2. **未点数量是计算字段还是存储字段？**
3. **合同金额是计算字段还是存储字段？**
4. **期货委托单表是否需要完整的字段定义（必填、选填、系统缺省）？**
5. **期现备注表中的"委托单短编号"是存储字段还是关联显示字段？**
6. **合同表中"供应商/客户"是同一个字段还是两个独立字段？**
7. **合同编号是否应该改为必填字段？如果不改为必填，没有合同编号的合同如何处理？**

1. **合同金额和结算金额是否需要支持筛选（范围筛选）？**
   - ✅ 用户确认不需要，保持当前文档即可

2. **合同编号是否应该改为必填字段？**
   - ✅ 用户确认必填，已在9_1文档中调整

3. **"是否主港"和"是否平台价"的"继承"状态的具体含义是什么？**
   - ✅ 用户确认没有继承状态，null视为未设置，已在9_3文档中更新说明和选项

4. **筛选时，客商和合同是否可以同时选择？**
   - ✅ 用户确认互斥，已在9_3文档的筛选说明中补充互斥约束

### 📝 待处理事项（低优先级）

1. **prototype.html列顺序与文档差异**
   - 用户暂时不希望调整，待后续一并处理

2. **字段命名映射**
   - 可以继续在prototype.html中使用英文/驼峰字段名，文档保持中文描述即可；后续若需统一再调整

---

**检查日期**：2025-01-XX
**检查人**：AI Assistant
