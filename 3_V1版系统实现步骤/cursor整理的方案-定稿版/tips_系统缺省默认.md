# 系统缺省默认配置

本文档定义系统各模块的缺省配置和默认行为，包括用户界面状态保存、设备响应式布局、数据字段缺省值、界面显示缺省值等。

---

## 一、用户界面状态保存

### 1.1 保存内容

系统会保存以下用户界面状态信息：

- **Tab页签状态**
  - 用户当前打开的页面（Tab页签）
  - Tab页签的打开顺序
  - 当前激活的Tab页签
  
- **页面布局配置**
  - 表格列显示/隐藏状态
  - 表格列宽设置
  - 表格列排序规则（排序字段、排序方向）
  - 表格筛选条件（筛选字段、筛选值）
  - 分页设置（每页显示条数）
  
- **左侧菜单状态**
  - 左侧菜单的折叠/展开状态
  - 当前选中的菜单项

### 1.2 保存方式

- **存储位置**：将用户当前页面和布局信息传到期现服务端进行记录
- **存储维度**：按用户ID（hedge_user）和设备类型分别存储
- **存储时机**：
  - 用户切换Tab页签时实时保存
  - 用户调整列宽、排序、筛选时实时保存
  - 用户关闭页面时保存最终状态
  - 用户修改菜单折叠状态时实时保存

### 1.3 设备类型区分

- **PC端和移动端分开存储**
  - PC端和移动端（手机）的界面状态需要分开存储
  - 用户在不同设备上登录时，会加载对应设备的界面状态
  - 例如：用户在PC上打开的Tab和布局，不会影响手机端的界面状态

- **设备类型判断**
  - 基于分辨率界限自动判断设备类型（参考2.1节）
  - PC端：分辨率 ≥ 768px
  - 移动端：分辨率 < 768px

### 1.4 异地登录恢复

- **跨设备恢复**
  - 用户在不同地点登录时，系统会加载该用户在该设备类型下保存的界面状态
  - 确保用户无论在哪里登录，都能看到上次使用时的界面布局
  
- **首次登录缺省值**
  - 如果用户首次登录或没有保存的界面状态，系统使用以下缺省值：
    - **默认首页**：个人工作台（指令工作台）
    - **菜单状态**：PC端默认展开，移动端默认折叠
    - **表格配置**：使用系统默认的列显示配置（参考各模块文档）
    - **分页大小**：默认每页显示20条（可配置）
    - **排序规则**：按创建日期时间降序排列（最新的在前）

---

## 二、设备响应式布局判断

### 2.1 分辨率界限

- **单一分辨率界限**
  - 系统只判断一个分辨率界限来区分设备类型
  - **默认分辨率界限**：768px（可配置）
  - **判断规则**：
    - 大于等于该界限：使用PC端布局
    - 小于该界限：使用移动端布局
  
- **分辨率判断依据**
  - 基于浏览器窗口宽度（window.innerWidth）进行判断
  - 在用户登录时和窗口大小改变时进行判断
  - 判断结果影响菜单结构、页面布局、界面交互方式

### 2.2 布局参数

- **统一判断标准**
  - 所有设备响应式布局的相关参数都基于这个单一的分辨率界限进行判断
  - 不需要多个断点或复杂的设备检测逻辑
  - 简化实现，提高性能

- **布局差异**
  - **PC端布局**（≥768px）：
    - 显示完整的一级菜单（根据用户权限）
    - 支持多Tab页签同时打开
    - 表格采用标准表格布局
    - 支持复杂的筛选和排序功能
    
  - **移动端布局**（<768px）：
    - 仅显示工作台和交易宝两个一级目录
    - 单Tab页签模式（不支持多Tab）
    - 列表采用卡片式布局
    - 简化筛选和排序功能

---

## 三、数据字段缺省值

### 3.1 通用缺省字段

以下字段在所有数据表中具有统一的缺省值规则：

- **状态字段**（status）
  - 缺省值：`"enable"`（启用）
  - 适用范围：合同表、客商表、现货品种表、品牌表、人员表、角色表、期货账户表、保值方案表等
  
- **创建人**（creator_id）
  - 缺省值：当前登录用户的人员ID
  - 适用范围：所有需要记录创建人的表
  
- **创建日期时间**（create_time）
  - 缺省值：当前系统时间（服务器时间）
  - 格式：`YYYY-MM-DD HH:mm:ss`
  - 适用范围：所有需要记录创建时间的表

### 3.2 业务表缺省字段

#### 3.2.1 合同表（contract）

- **已点数量**（priced_quantity）
  - 缺省值：`0`
  - 说明：点价合同的基础信息，初始为0
  
- **发生日期时间**（occur_time）
  - 缺省值：如果未填写，使用创建日期时间作为发生日期时间

#### 3.2.2 品牌表（spot_brand）

- **是否主港**（is_main_port）
  - 缺省值：`false`
  
- **是否平台价**（is_platform_price）
  - 缺省值：`false`

#### 3.2.3 期货委托单表（entrust_order）

- **已匹配手数**（matched_lots）
  - 缺省值：`0`

### 3.3 缺省值应用规则

- **新增记录时**：系统自动填充缺省字段，用户无需手动填写
- **编辑记录时**：缺省字段可以修改，但通常不建议修改创建人和创建时间
- **数据导入时**：如果导入数据中未包含缺省字段，系统自动填充缺省值

---

## 四、界面显示缺省值

### 4.1 表格显示缺省值

- **分页设置**
  - 默认每页显示条数：`20`条
  - 可选分页大小：`10`、`20`、`50`、`100`条
  - 用户可自定义分页大小，设置会保存到用户界面状态中
  
- **排序规则**
  - 默认排序字段：`创建日期时间`（create_time）
  - 默认排序方向：`降序`（DESC，最新的在前）
  - 用户可自定义排序规则，设置会保存到用户界面状态中
  
- **列显示配置**
  - 默认显示列：参考各模块文档中的"默认字段显示"约定
  - 用户可通过列配置功能自定义显示哪些列
  - 列配置信息保存到用户界面状态中

### 4.2 日期时间格式

- **日期格式**：`YYYY-MM-DD`（如：2025-01-15）
- **时间格式**：`YYYY-MM-DD HH:mm:ss`（如：2025-01-15 14:30:00）
- **日期时间选择器**：统一使用系统默认格式

### 4.3 数字格式

- **数量显示**：
  - 整数部分使用千分位分隔符（如：1,000）
  - 小数部分保留2位小数（如：1,000.00）
  - 根据业务需要可调整小数位数
  
- **金额显示**：
  - 整数部分使用千分位分隔符
  - 小数部分保留2位小数
  - 带货币符号（如：¥1,000.00 或 1,000.00元）
  
- **价格显示**：
  - 整数部分使用千分位分隔符
  - 小数部分保留2位小数
  - 带单位（如：1,000.00元/吨）

### 4.4 菜单和导航缺省值

- **PC端菜单**
  - 默认展开状态：展开（显示所有有权限的菜单项）
  - 默认选中项：个人工作台
  
- **移动端菜单**
  - 默认折叠状态：折叠（点击后展开）
  - 默认选中项：工作台

### 4.5 筛选条件缺省值

- **日期范围筛选**
  - 默认时间范围：最近30天
  - 起始日期：30天前
  - 结束日期：今天
  
- **状态筛选**
  - 默认显示：启用状态（status = "enable"）
  - 用户可选择显示全部、仅启用、仅禁用等

---

## 五、系统参数缺省值

### 5.1 分辨率界限配置

- **默认值**：`768`px
- **配置位置**：系统全局配置（可在全局设置中修改）
- **修改影响**：修改后会影响所有用户的设备类型判断，需要谨慎操作

### 5.2 会话超时设置

- **默认超时时间**：`30`分钟（无操作后自动登出）
- **超时提醒**：超时前5分钟弹出提醒
- **配置位置**：系统全局配置

### 5.3 数据刷新频率

- **表格数据刷新**：手动刷新（用户点击刷新按钮）
- **实时数据刷新**（如交易宝行情）：
  - PC端：默认3秒刷新一次
  - 移动端：默认5秒刷新一次
  - 用户可自定义刷新频率

---

## 六、用户首次登录缺省行为

### 6.1 新用户首次登录

当用户首次登录系统时，如果没有任何保存的界面状态，系统使用以下缺省配置：

- **默认首页**：个人工作台（指令工作台）
- **菜单状态**：
  - PC端：左侧菜单展开
  - 移动端：左侧菜单折叠
- **表格配置**：使用系统默认的列显示配置
- **分页大小**：20条/页
- **排序规则**：按创建日期时间降序
- **筛选条件**：无筛选（显示全部数据）

### 6.2 缺省配置的优先级

- **用户自定义配置** > **系统缺省配置**
- 用户一旦保存了自定义配置，系统会优先使用用户配置
- 用户可以通过"重置为默认"功能恢复系统缺省配置

---

## 七、配置的持久化和同步

### 7.1 配置存储

- **存储位置**：期现服务端数据库
- **存储表**：用户界面状态表（user_interface_state）
- **存储字段**：
  - 用户ID（hedge_user_id）
  - 设备类型（device_type：PC/MOBILE）
  - 配置内容（JSON格式存储）

### 7.2 配置同步

- **实时同步**：用户操作后立即保存到服务端
- **跨设备同步**：同一用户在同一设备类型下的配置会同步到所有设备
- **配置冲突处理**：以最后一次保存的配置为准

### 7.3 配置恢复

- **自动恢复**：用户登录时自动加载保存的配置
- **手动重置**：用户可以通过"重置为默认"功能恢复系统缺省配置
- **配置备份**：系统保留最近3次配置变更历史，支持回滚

---

## 八、注意事项

### 8.1 性能考虑

- 界面状态保存采用增量更新，只保存变更的部分
- 配置数据采用JSON格式压缩存储，减少存储空间
- 配置加载采用懒加载，只在需要时加载对应页面的配置

### 8.2 兼容性考虑

- 配置格式采用向后兼容设计，旧版本配置可以自动升级
- 系统升级时，会自动迁移用户配置到新版本格式
- 如果配置格式不兼容，系统会使用缺省配置，并提示用户重新配置

### 8.3 安全性考虑

- 用户只能查看和修改自己的配置
- 管理员可以查看所有用户的配置（用于问题排查）
- 配置变更会记录操作日志，便于审计
